<!DOCTYPE html>
<html>
<head>
  <title>Ceris 1&2 Contact Reference</title>
  <link rel="icon" type="image/png" href="images/chai_logo.png">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input { width: 100%; padding: 10px; margin-bottom: 20px; font-size: 16px; }
    .contact { padding: 10px; border-bottom: 1px solid #ccc; }
    .contact:last-child { border-bottom: none; }
    .logo-circle {
      display: block;
      margin: 0 auto 20px auto;
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 50%;
      border: 2px solid #ccc;
      background: #fff;
    }
    #login-form {
      max-width: 400px;
      margin: 60px auto 0 auto;
      padding: 30px 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #fafafa;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    #login-form input[type="text"], #login-form input[type="password"] {
      width: 100%;
      margin-bottom: 14px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #aaa;
      border-radius: 4px;
    }
    #login-form button {
      width: 100%;
      padding: 10px;
      background: #2d89ef;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
    }
    #login-error { color: red; margin-bottom: 10px; text-align: center; }
    #loading { text-align: center; color: #2d89ef; margin-bottom: 20px; }
    #logout-btn {
      display: block;
      margin: 10px auto 20px auto;
      padding: 8px 16px;
      background: #e74c3c;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 15px;
      cursor: pointer;
    }
    #logout-btn:hover { background: #c0392b; }
  </style>
</head>
<body>

  <div id="login-form">
    <img src="images/chai_logo.png" alt="Logo" class="logo-circle" style="width:60px;height:60px;margin-bottom:20px;">
    <h2 style="text-align:center;">Login Required</h2>
    <div id="login-error"></div>
    <input type="text" placeholder="Username" id="username" autocomplete="off" autofocus>
    <input type="password" placeholder="Password" id="password" autocomplete="off">
    <button id="login-btn" onclick="login()">Login</button>
  </div>

  <div id="main-content" style="display:none;">
    <img src="images/chai_logo.png" alt="Logo" class="logo-circle">
    <button id="logout-btn" onclick="logout()" style="display:none;">Logout</button>
    <h2>Search Contacts</h2>
    <input type="text" id="search" placeholder="Type either name, address, or plate number...">
    <div id="loading" style="display:none;">Loading...</div>
    <div id="results"></div>
  </div>

<script>
  // Replace with your actual logging script Web App URL
  const logScriptURL = "https://script.google.com/macros/s/AKfycbxJqA-pm79QKPW_RlwTbic7xez-mXpOEXe_BpuL56LPLzK8HbBI2UuE46EJeJfBv2Zx/exec";
  const sheetURL = "https://script.google.com/macros/s/AKfycbxJqA-pm79QKPW_RlwTbic7xez-mXpOEXe_BpuL56LPLzK8HbBI2UuE46EJeJfBv2Zx/exec";

  // Hardcoded credentials (add as many as needed)
  const AUTHORIZED_USERS = [
    { username: "James123", password: "mejasdegs1A*" },
    { username: "Marksiaga", password: "siagamark871030" },
    { username: "Isalmiranez", password: "$ecreTary061085" },
    { username: "Jsmania40", password: "Pewpewpew" },
    { username: "Marloncmdez", password: "mcmnov181979" },
    { username: "Anicetomlon", password: "ambapr171962" },
    { username: "Arthurrio", password: "arrdec171987" },
    { username: "mannythemessenger", password: "Dani0530" },
    { username: "Aldrincortez59", password: "aldrin-123" },
    { username: "Junartorres3@gmail.com", password: "Jonard0603" }
  ];

  let contacts = [];

  function showLoading(show) {
    document.getElementById("loading").style.display = show ? "" : "none";
  }

  // Logging function
  async function logAccess(username) {
    showLoading(true);
    const response = await fetch(logScriptURL, {
      method: 'POST',
      body: JSON.stringify({ username }),
      headers: { 'Content-Type': 'application/json' }
    });
    showLoading(false);
    const result = await response.text();
    if (result !== "Success") {
      throw new Error(result || "Unknown logging error");
    }
  }

  // Main login logic
  async function login() {
    const uname = document.getElementById("username").value.trim();
    const pass = document.getElementById("password").value;
    const errorDiv = document.getElementById("login-error");
    const loginBtn = document.getElementById("login-btn");
    errorDiv.style.color = "red";
    errorDiv.textContent = "";
    loginBtn.disabled = true;
    showLoading(false);

    const matched = AUTHORIZED_USERS.some(u =>
      u.username === uname && u.password === pass
    );
    if (matched) {
      errorDiv.style.color = "#2d89ef";
      errorDiv.textContent = "Logging access. Please wait...";
      try {
        await logAccess(uname);
        errorDiv.textContent = "";
        document.getElementById("login-form").style.display = "none";
        document.getElementById("main-content").style.display = "";
        document.getElementById("logout-btn").style.display = "block";
        document.getElementById("search").focus();
        fetchContacts();
      } catch (err) {
        errorDiv.style.color = "red";
        errorDiv.textContent = "Login succeeded, but logging failed: " + err.message;
      }
    } else {
      errorDiv.textContent = "Invalid username or password.";
    }
    loginBtn.disabled = false;
  }

  // Allow pressing Enter to submit login
  document.getElementById("password").addEventListener("keyup", function(e) {
    if (e.key === "Enter") login();
  });

  document.getElementById("username").addEventListener("keyup", function(e) {
    if (e.key === "Enter") document.getElementById("password").focus();
  });

  // Fetch contacts from Google Apps Script
  async function fetchContacts() {
    showLoading(true);
    const container = document.getElementById("results");
    container.innerHTML = "";
    try {
      const res = await fetch(sheetURL);
      contacts = await res.json();
      showLoading(false);
    } catch (err) {
      showLoading(false);
      container.innerHTML = "<span style='color:red'>Failed to load contacts.<br>" + err + "</span>";
    }
  }

  // Display contacts
  function displayContacts(list) {
    const container = document.getElementById("results");
    container.innerHTML = "";
    if (!list.length) {
      container.innerHTML = "<em>No contacts found.</em>";
      return;
    }
    list.forEach(contact => {
      const div = document.createElement("div");
      div.className = "contact";
      div.innerHTML = `
        <strong>${contact.Name}</strong><br>
        üè† ${contact.Address || ""}<br>
        üìû ${contact["Phone Number"] || ""}<br>
        ‚úâÔ∏è ${contact.Email || ""}<br>
        üè∑Ô∏è ${contact.Category || ""}<br>
        üöó ${contact["Vehicle / Plate Number"] || ""}
      `;
      container.appendChild(div);
    });
  }

  // Search logic
  document.getElementById("search").addEventListener("input", e => {
    const term = e.target.value.toLowerCase();
    if (!term) {
      document.getElementById("results").innerHTML = "";
      return;
    }
    const filtered = contacts.filter(c =>
      (c.Name && String(c.Name).toLowerCase().includes(term)) ||
      (c.Address && String(c.Address).toLowerCase().includes(term)) ||
      (c["Phone Number"] && String(c["Phone Number"]).toLowerCase().includes(term)) ||
      (c.Email && String(c.Email).toLowerCase().includes(term)) ||
      (c.Category && String(c.Category).toLowerCase().includes(term)) ||
      (c["Plate Number"] && String(c["Plate Number"]).toLowerCase().includes(term)) ||
      (c["Vehicle / Plate Number"] && String(c["Vehicle / Plate Number"]).toLowerCase().includes(term))
    );
    displayContacts(filtered);
  });

  // Logout logic (optional, for good UX)
  function logout() {
    document.getElementById("main-content").style.display = "none";
    document.getElementById("login-form").style.display = "";
    document.getElementById("username").value = "";
    document.getElementById("password").value = "";
    document.getElementById("search").value = "";
    document.getElementById("results").innerHTML = "";
    document.getElementById("login-error").textContent = "";
    document.getElementById("logout-btn").style.display = "none";
    document.getElementById("username").focus();
  }

</script>

<style>
.logo-circle {
  display: block;
  margin: 0 auto 20px auto;
  width: 80px;
  height: 80px;
  object-fit: cover;
  object-position: center 90%;
  border-radius: 50%;
  border: 3px solid #ccc;
  background: #fff;
  padding: 0;
  transform: scale(1.5);
}
</style>

</body>
</html>
